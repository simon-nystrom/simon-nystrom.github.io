<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Newcurrent | A curious software engineer</title><meta name="description" content="Newcurrent is the blog of a software engineer with a passion for learning and developing as a professional. I write about all kinds of topics related to software engineering / programming."/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/a8757238fe796709.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a8757238fe796709.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-6e4ba497ae0c8a3f.js" defer=""></script><script src="/_next/static/chunks/main-41b7f808e4e58e02.js" defer=""></script><script src="/_next/static/chunks/pages/_app-df9e9ec4f559d970.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-536da701fd334d68.js" defer=""></script><script src="/_next/static/s7IJjWTiytAHnB5TZHRPS/_buildManifest.js" defer=""></script><script src="/_next/static/s7IJjWTiytAHnB5TZHRPS/_ssgManifest.js" defer=""></script><script src="/_next/static/s7IJjWTiytAHnB5TZHRPS/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="p-4"><div class="flex items-center mb-8"><h1 class="text-xl border-r border-orange-300 pr-6">newcurrent</h1><nav class="pl-6"><ul class="flex gap-6 justify-items-end"><li class="text-orange-300 font-semibold"><a href="/">Home</a></li></ul></nav></div><div class="pb-20"><h1 class="text-3xl mb-4 font-semibold max-w-screen-md mx-auto">Adding contextual serialization in Ktor</h1><div class="flex -mt-2 mb-4 text-sm justify-between mx-auto max-w-screen-md"><span class="font-bold">2022-01-15</span><div class="flex-col sm:flex-row items-end flex gap-2 font-semibold"><span class="rounded-full px-2 bg-orange-200 text-white text-sm bg-opacity-20">kotlin</span><span class="rounded-full px-2 bg-pink-200 text-white text-sm bg-opacity-20">ktor</span></div></div><h2 class="text-2xl my-4 max-w-screen-md mx-auto">What is Ktor?</h2><p class="leading-relaxed max-w-screen-md mx-auto mb-4">Ktor is a Kotlin framework for building web applications and HTTP services.</p><p class="leading-relaxed max-w-screen-md mx-auto mb-4">This blog post will focus on an issue I ran into recently concerning to JSON serialization when using Ktor (adding contextual serialization).</p><p class="leading-relaxed max-w-screen-md mx-auto mb-4">If you&#x27;re into Kotlin and you haven&#x27;t tried Ktor yet, I highly suggest you try it out. You can read more about Ktor <a target="_blank" class="text-blue-400" href="https://ktor.io/docs/welcome.html">here</a>.</p><hr class="border-orange-200 my-8 border-dashed mx-auto max-w-screen-sm"/><h2 class="text-2xl my-4 max-w-screen-md mx-auto">JSON Serialization in Ktor</h2><p class="leading-relaxed max-w-screen-md mx-auto mb-4">The process of turning objects into JSON data is a common task and most of the time it&#x27;s a non-issue; turning an <code class="bg-gray-700 px-1 rounded-sm text-orange-100">Int</code> into a JSON number is simple, turning a <code class="bg-gray-700 px-1 rounded-sm text-orange-100">String</code> into a JSON string is simple and so on. Eventually you will run into a situation where you need to either customize your serialization logic or provide a serialization implementation for a non-primitive value.</p><br/><p class="leading-relaxed max-w-screen-md mx-auto mb-4">The <a target="_blank" class="text-blue-400" href="https://ktor.io/docs/serialization.html">Ktor docs</a> are great as a start and they even show you how to use three built-in converters (<code class="bg-gray-700 px-1 rounded-sm text-orange-100">Gson</code>, <code class="bg-gray-700 px-1 rounded-sm text-orange-100">Jackson</code> and <code class="bg-gray-700 px-1 rounded-sm text-orange-100">kotlinx.serialization</code>). For my project I&#x27;m using <code class="bg-gray-700 px-1 rounded-sm text-orange-100">kotlinx.serialization</code> and the issue at hand will be solved for that converter, but the concept is the same for the others.</p><br/><p class="leading-relaxed max-w-screen-md mx-auto mb-4">A minimal <code class="bg-gray-700 px-1 rounded-sm text-orange-100">Ktor</code> setup with JSON serialization might look like this:</p><div class="remark-highlight"><pre class="mx-auto block my-8 language-kotlin"><code class="max-w-screen-md"><span class="token annotation builtin">@Serializable</span>
<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Response</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> value<span class="token operator">:</span> String<span class="token punctuation">)</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">embeddedServer</span><span class="token punctuation">(</span>Netty<span class="token punctuation">,</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">,</span> host <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">install</span><span class="token punctuation">(</span>ContentNegotiation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        routing <span class="token punctuation">{</span>
            <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span><span class="token function">Response</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>wait <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="leading-relaxed max-w-screen-md mx-auto mb-4">As expected, visiting http://localhost:8080 returns the following:</p><div class="remark-highlight"><pre class="mx-auto block my-8 language-json"><code class="max-w-screen-md"><span class="token punctuation">{</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello World!&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr class="border-orange-200 my-8 border-dashed mx-auto max-w-screen-sm"/><h2 class="text-2xl my-4 max-w-screen-md mx-auto">The Issue</h2><p class="leading-relaxed max-w-screen-md mx-auto mb-4">Let&#x27;s illustrate a case where you might run into an issue.</p><br/><p class="leading-relaxed max-w-screen-md mx-auto mb-4">In my project, I want failing requests, those that generate server-side exceptions, to translate these exceptions into response objects with the properties <code class="bg-gray-700 px-1 rounded-sm text-orange-100">errorMessage</code> and <code class="bg-gray-700 px-1 rounded-sm text-orange-100">statusCode</code>.</p><br/><p class="leading-relaxed max-w-screen-md mx-auto mb-4">One might start by attempting the following:</p><div class="remark-highlight"><pre class="mx-auto block my-8 language-kotlin"><code class="max-w-screen-md"><span class="token annotation builtin">@Serializable</span>
<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">DuplicateEntryException</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> errorMessage<span class="token operator">:</span> String<span class="token punctuation">,</span>

    <span class="token annotation builtin">@Contextual</span> <span class="token comment">// Required, this specifies that this converter is expected to be found during runtime</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> statusCode<span class="token operator">:</span> HttpStatusCode <span class="token operator">=</span> HttpStatusCode<span class="token punctuation">.</span>Conflict
<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">RuntimeException</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">embeddedServer</span><span class="token punctuation">(</span>Netty<span class="token punctuation">,</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">,</span> host <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">install</span><span class="token punctuation">(</span>ContentNegotiation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        routing <span class="token punctuation">{</span>
            <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Faked error for simplicity&#x27;s sake</span>
                call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span><span class="token function">DuplicateEntryException</span><span class="token punctuation">(</span><span class="token string">&quot;This entry already exists&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>wait <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="leading-relaxed max-w-screen-md mx-auto mb-4">Starting the project now and visiting http://localhost:8080 will result in the following exception:</p><div class="remark-highlight"><pre class="mx-auto block my-8 language-json"><code class="max-w-screen-md">kotlinx.serialization.SerializationException<span class="token operator">:</span> Serializer for class &#x27;HttpStatusCode&#x27; is not found.
</code></pre></div><hr class="border-orange-200 my-8 border-dashed mx-auto max-w-screen-sm"/><h2 class="text-2xl my-4 max-w-screen-md mx-auto">The Solution</h2><p class="leading-relaxed max-w-screen-md mx-auto mb-4">As the exception is telling us, we need to register a serializer for the <code class="bg-gray-700 px-1 rounded-sm text-orange-100">HttpStatusCode</code> type. There are two ways of doing this, depending on your use case. I will illustrate both variants below.</p><br/><p class="leading-relaxed max-w-screen-md mx-auto mb-4">Our first order of business, which will be used in both solutions, is to define the custom serializer:</p><div class="remark-highlight"><pre class="mx-auto block my-8 language-kotlin"><code class="max-w-screen-md"><span class="token keyword">object</span> HttpStatusCodeSerializer <span class="token operator">:</span> KSerializer<span class="token operator">&lt;</span>HttpStatusCode<span class="token operator">&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">deserialize</span><span class="token punctuation">(</span>decoder<span class="token operator">:</span> Decoder<span class="token punctuation">)</span><span class="token operator">:</span> HttpStatusCode <span class="token operator">=</span>
        HttpStatusCode<span class="token punctuation">.</span><span class="token function">fromValue</span><span class="token punctuation">(</span>decoder<span class="token punctuation">.</span><span class="token function">decodeInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">serialize</span><span class="token punctuation">(</span>encoder<span class="token operator">:</span> Encoder<span class="token punctuation">,</span> value<span class="token operator">:</span> HttpStatusCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        encoder<span class="token punctuation">.</span><span class="token function">encodeInt</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">val</span> descriptor<span class="token operator">:</span> SerialDescriptor <span class="token operator">=</span> <span class="token function">PrimitiveSerialDescriptor</span><span class="token punctuation">(</span><span class="token string">&quot;HttpStatusCode&quot;</span><span class="token punctuation">,</span> PrimitiveKind<span class="token punctuation">.</span>INT<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="leading-relaxed max-w-screen-md mx-auto mb-4">Basically, turn the <code class="bg-gray-700 px-1 rounded-sm text-orange-100">HttpStatusCode</code> object into a primitive type, <code class="bg-gray-700 px-1 rounded-sm text-orange-100">Int</code> in this case.</p><br/><p class="leading-relaxed max-w-screen-md mx-auto mb-4">Next up we need to use this, the first way is to add it to our <code class="bg-gray-700 px-1 rounded-sm text-orange-100">json()</code> converter definition, like so:</p><div class="remark-highlight"><pre class="mx-auto block my-8 language-kotlin"><code class="max-w-screen-md"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">embeddedServer</span><span class="token punctuation">(</span>Netty<span class="token punctuation">,</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">,</span> host <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">install</span><span class="token punctuation">(</span>ContentNegotiation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">json</span><span class="token punctuation">(</span>Json <span class="token punctuation">{</span>
                serializersModule <span class="token operator">=</span> SerializersModule <span class="token punctuation">{</span>
                    <span class="token function">contextual</span><span class="token punctuation">(</span>HttpStatusCode<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> HttpStatusCodeSerializer<span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        routing <span class="token punctuation">{</span>
            <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Faked error for simplicity&#x27;s sake</span>
                call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span><span class="token function">DuplicateEntryException</span><span class="token punctuation">(</span><span class="token string">&quot;This entry already exists&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>wait <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="leading-relaxed max-w-screen-md mx-auto mb-4">I prefer this solution when you want your serialization to be easily reusable, for example <code class="bg-gray-700 px-1 rounded-sm text-orange-100">DuplicateEntryException</code> is generic enough to be reused across use cases in the project.</p><br/><p class="leading-relaxed max-w-screen-md mx-auto mb-4">If you want to customize serialization in a more localized fashion, something that might only be used for some specific purpose, you can do the following instead:</p><div class="remark-highlight"><pre class="mx-auto block my-8 language-kotlin"><code class="max-w-screen-md"><span class="token annotation builtin">@Serializable</span>
<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">DuplicateEntryException</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> errorMessage<span class="token operator">:</span> String<span class="token punctuation">,</span>

    <span class="token annotation builtin">@Contextual</span>
    <span class="token annotation builtin">@Serializable</span><span class="token punctuation">(</span>with <span class="token operator">=</span> HttpStatusCodeSerializer<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// Inform which Serializer to use for this property</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> statusCode<span class="token operator">:</span> HttpStatusCode <span class="token operator">=</span> HttpStatusCode<span class="token punctuation">.</span>Conflict
<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">RuntimeException</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span>
</code></pre></div><hr class="border-orange-200 my-8 border-dashed mx-auto max-w-screen-sm"/><h2 class="text-2xl my-4 max-w-screen-md mx-auto">Resources</h2><p class="leading-relaxed max-w-screen-md mx-auto mb-4">If you want to learn more about <code class="bg-gray-700 px-1 rounded-sm text-orange-100">Ktor</code> or <code class="bg-gray-700 px-1 rounded-sm text-orange-100">kotlinx.serialization</code>, you can read more at the following resources:</p><ul class="list-disc pl-4 py-4 max-w-screen-md mx-auto"><li class="text-orange-400"><div class="text-white"><a target="_blank" class="text-blue-400" href="https://ktor.io/docs/serialization.html">Content negotiation and serialization</a></div></li><li class="text-orange-400"><div class="text-white"><a target="_blank" class="text-blue-400" href="https://ktor.io/docs/kotlin-serialization.html">kotlinx.serialization for Ktor</a></div></li><li class="text-orange-400"><div class="text-white"><a target="_blank" class="text-blue-400" href="https://github.com/Kotlin/kotlinx.serialization">kotlinx.serialization at GitHub</a></div></li></ul></div><div class="mx-auto max-w-screen-md flex text-gray-300 items-center gap-4 justify-center"><a target="_blank" class="w-6 hover:text-orange-400 duration-150 transition-colors" href="https://www.linkedin.com/in/simon-nystr%C3%B6m-192b12a5/"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a class="w-8 hover:text-orange-400 duration-150 transition-colors" href="mailto:simon.nystrom90@gmail.com"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg></a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"var N=Object.defineProperty,l=Object.defineProperties;var u=Object.getOwnPropertyDescriptors;var o=Object.getOwnPropertySymbols;var p=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable;var r=(e,n,t)=\u003en in e?N(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,a=(e,n)=\u003e{for(var t in n||(n={}))p.call(n,t)\u0026\u0026r(e,t,n[t]);if(o)for(var t of o(n))c.call(n,t)\u0026\u0026r(e,t,n[t]);return e},m=(e,n)=\u003el(e,u(n));var i=(e,n)=\u003e{var t={};for(var s in e)p.call(e,s)\u0026\u0026n.indexOf(s)\u003c0\u0026\u0026(t[s]=e[s]);if(e!=null\u0026\u0026o)for(var s of o(e))n.indexOf(s)\u003c0\u0026\u0026c.call(e,s)\u0026\u0026(t[s]=e[s]);return t};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(t){var s=t,{components:e}=s,n=i(s,[\"components\"]);return mdx(MDXLayout,m(a(a({},layoutProps),n),{components:e,mdxType:\"MDXLayout\"}),mdx(\"h2\",null,\"What is Ktor?\"),mdx(\"p\",null,\"Ktor is a Kotlin framework for building web applications and HTTP services.\"),mdx(\"p\",null,\"This blog post will focus on an issue I ran into recently concerning to JSON serialization when using Ktor (adding contextual serialization).\"),mdx(\"p\",null,\"If you're into Kotlin and you haven't tried Ktor yet, I highly suggest you try it out. You can read more about Ktor \",mdx(\"a\",a({parentName:\"p\"},{href:\"https://ktor.io/docs/welcome.html\"}),\"here\"),\".\"),mdx(\"hr\",null),mdx(\"h2\",null,\"JSON Serialization in Ktor\"),mdx(\"p\",null,\"The process of turning objects into JSON data is a common task and most of the time it's a non-issue; turning an \",mdx(\"inlineCode\",{parentName:\"p\"},\"Int\"),\" into a JSON number is simple, turning a \",mdx(\"inlineCode\",{parentName:\"p\"},\"String\"),\" into a JSON string is simple and so on. Eventually you will run into a situation where you need to either customize your serialization logic or provide a serialization implementation for a non-primitive value.\"),mdx(\"br\",null),mdx(\"p\",null,\"The \",mdx(\"a\",a({parentName:\"p\"},{href:\"https://ktor.io/docs/serialization.html\"}),\"Ktor docs\"),\" are great as a start and they even show you how to use three built-in converters (\",mdx(\"inlineCode\",{parentName:\"p\"},\"Gson\"),\", \",mdx(\"inlineCode\",{parentName:\"p\"},\"Jackson\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"kotlinx.serialization\"),\"). For my project I'm using \",mdx(\"inlineCode\",{parentName:\"p\"},\"kotlinx.serialization\"),\" and the issue at hand will be solved for that converter, but the concept is the same for the others.\"),mdx(\"br\",null),mdx(\"p\",null,\"A minimal \",mdx(\"inlineCode\",{parentName:\"p\"},\"Ktor\"),\" setup with JSON serialization might look like this:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-kotlin\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-kotlin\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token annotation builtin\"}),\"@Serializable\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"data\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"Response\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"private\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"val\"),\" value\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" String\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"fun\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"main\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"embeddedServer\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"Netty\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" port \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"8080\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" host \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"127.0.0.1\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"install\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ContentNegotiation\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"json\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n        routing `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"get\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"/\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n                call`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"respond\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"Response\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Hello World!\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"start\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"wait \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"p\",null,\"As expected, visiting http://localhost:8080 returns the following:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token property\"}),'\"value\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Hello World!\"'),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"hr\",null),mdx(\"h2\",null,\"The Issue\"),mdx(\"p\",null,\"Let's illustrate a case where you might run into an issue.\"),mdx(\"br\",null),mdx(\"p\",null,\"In my project, I want failing requests, those that generate server-side exceptions, to translate these exceptions into response objects with the properties \",mdx(\"inlineCode\",{parentName:\"p\"},\"errorMessage\"),\" and \",mdx(\"inlineCode\",{parentName:\"p\"},\"statusCode\"),\".\"),mdx(\"br\",null),mdx(\"p\",null,\"One might start by attempting the following:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-kotlin\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-kotlin\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token annotation builtin\"}),\"@Serializable\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"data\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"DuplicateEntryException\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"private\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"val\"),\" errorMessage\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" String\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token annotation builtin\"}),\"@Contextual\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"// Required, this specifies that this converter is expected to be found during runtime\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"private\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"val\"),\" statusCode\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" HttpStatusCode \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" HttpStatusCode\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),`Conflict\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"RuntimeException\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"errorMessage\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"fun\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"main\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"embeddedServer\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"Netty\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" port \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"8080\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" host \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"127.0.0.1\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"install\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ContentNegotiation\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"json\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n        routing `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"get\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"/\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n                `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"// Faked error for simplicity's sake\"),`\n                call`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"respond\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"DuplicateEntryException\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"This entry already exists\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"start\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"wait \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"p\",null,\"Starting the project now and visiting http://localhost:8080 will result in the following exception:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-json\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-json\"}),\"kotlinx.serialization.SerializationException\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),` Serializer for class 'HttpStatusCode' is not found.\n`))),mdx(\"hr\",null),mdx(\"h2\",null,\"The Solution\"),mdx(\"p\",null,\"As the exception is telling us, we need to register a serializer for the \",mdx(\"inlineCode\",{parentName:\"p\"},\"HttpStatusCode\"),\" type. There are two ways of doing this, depending on your use case. I will illustrate both variants below.\"),mdx(\"br\",null),mdx(\"p\",null,\"Our first order of business, which will be used in both solutions, is to define the custom serializer:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-kotlin\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-kotlin\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"object\"),\" HttpStatusCodeSerializer \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" KSerializer\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"\u003c\"),\"HttpStatusCode\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"\u003e\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"override\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"fun\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"deserialize\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"decoder\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" Decoder\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" HttpStatusCode \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),`\n        HttpStatusCode`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"fromValue\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"decoder\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"decodeInt\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n\n\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"override\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"fun\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"serialize\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"encoder\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" Encoder\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" value\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" HttpStatusCode\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        encoder`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"encodeInt\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"value\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"value\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"override\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"val\"),\" descriptor\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" SerialDescriptor \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"PrimitiveSerialDescriptor\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"HttpStatusCode\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" PrimitiveKind\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"INT\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"p\",null,\"Basically, turn the \",mdx(\"inlineCode\",{parentName:\"p\"},\"HttpStatusCode\"),\" object into a primitive type, \",mdx(\"inlineCode\",{parentName:\"p\"},\"Int\"),\" in this case.\"),mdx(\"br\",null),mdx(\"p\",null,\"Next up we need to use this, the first way is to add it to our \",mdx(\"inlineCode\",{parentName:\"p\"},\"json()\"),\" converter definition, like so:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-kotlin\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-kotlin\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"fun\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"main\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"embeddedServer\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"Netty\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" port \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"8080\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" host \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"127.0.0.1\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"install\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"ContentNegotiation\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"json\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"Json \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n                serializersModule `,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" SerializersModule \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n                    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"contextual\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"HttpStatusCode\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"::\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),\" HttpStatusCodeSerializer\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n                `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n        routing `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"get\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"/\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n                `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"// Faked error for simplicity's sake\"),`\n                call`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"respond\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"DuplicateEntryException\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"This entry already exists\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"start\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"wait \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`))),mdx(\"p\",null,\"I prefer this solution when you want your serialization to be easily reusable, for example \",mdx(\"inlineCode\",{parentName:\"p\"},\"DuplicateEntryException\"),\" is generic enough to be reused across use cases in the project.\"),mdx(\"br\",null),mdx(\"p\",null,\"If you want to customize serialization in a more localized fashion, something that might only be used for some specific purpose, you can do the following instead:\"),mdx(\"div\",a({},{className:\"remark-highlight\"}),mdx(\"pre\",a({parentName:\"div\"},{className:\"language-kotlin\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-kotlin\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token annotation builtin\"}),\"@Serializable\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"data\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"DuplicateEntryException\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"private\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"val\"),\" errorMessage\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" String\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token annotation builtin\"}),\"@Contextual\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token annotation builtin\"}),\"@Serializable\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"with \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" HttpStatusCodeSerializer\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"::\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"class\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"// Inform which Serializer to use for this property\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"private\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"val\"),\" statusCode\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" HttpStatusCode \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" HttpStatusCode\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),`Conflict\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\":\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"RuntimeException\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"errorMessage\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`))),mdx(\"hr\",null),mdx(\"h2\",null,\"Resources\"),mdx(\"p\",null,\"If you want to learn more about \",mdx(\"inlineCode\",{parentName:\"p\"},\"Ktor\"),\" or \",mdx(\"inlineCode\",{parentName:\"p\"},\"kotlinx.serialization\"),\", you can read more at the following resources:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",a({parentName:\"li\"},{href:\"https://ktor.io/docs/serialization.html\"}),\"Content negotiation and serialization\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",a({parentName:\"li\"},{href:\"https://ktor.io/docs/kotlin-serialization.html\"}),\"kotlinx.serialization for Ktor\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",a({parentName:\"li\"},{href:\"https://github.com/Kotlin/kotlinx.serialization\"}),\"kotlinx.serialization at GitHub\"))))}MDXContent.isMDXComponent=!0;\n","scope":{}},"meta":{"title":"Adding contextual serialization in Ktor","author":"Simon Nyström","date":"2022-01-15","tags":["kotlin","ktor"],"slug":"ktor-contextual-serialization"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"ktor-contextual-serialization"},"buildId":"s7IJjWTiytAHnB5TZHRPS","isFallback":false,"gsp":true,"scriptLoader":[]}</script><a style="position:fixed;bottom:0;font-size:10px;padding:4px" href="/privacy_policy">Privacy Policy</a></body></html>